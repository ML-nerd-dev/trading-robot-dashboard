# app.py
import streamlit as st
import pandas as pd
import plotly.graph_objects as go
from datetime import datetime, timedelta
import numpy as np

st.set_page_config(page_title="Trading Robot Live", layout="wide", page_icon="ðŸ¤–")

st.title("Live Trading Robot Dashboard")
st.markdown("### Real-time PnL â€¢ Auto Buy/Sell Signals â€¢ Backtest Results â€¢ 24/7")

# Simulate live data
@st.cache_data(ttl=60)
def get_data():
    np.random.seed(42)
    dates = pd.date_range(end=datetime.now(), periods=500, freq='5min')
    price = 65000 + np.cumsum(np.random.randn(500)*80)
    df = pd.DataFrame({
        'time': dates,
        'price': price,
        'signal': np.random.choice(['BUY', 'SELL', 'HOLD'], 500, p=[0.15, 0.15, 0.7]),
        'pnl': np.cumsum(np.random.randn(500)*25)
    })
    return df

df = get_data()

col1, col2, col3, col4 = st.columns(4)
col1.metric("Current Price", f"${df['price'].iloc[-1]:,.2f}", delta=f"{df['price'].diff().iloc[-1]:+.2f}")
col2.metric("24h PnL", "$+1,842.50", delta="+12.4%")
col3.metric("Win Rate", "68.4%", delta="+2.1%")
col4.metric("Total Trades", "342", delta="12 today")

# Live chart
fig = go.Figure()
fig.add_trace(go.Scatter(x=df['time'], y=df['price'], name='Price', line=dict(color='#00ff88')))
buy = df[df['signal']=='BUY']
sell = df[df['signal']=='SELL']
fig.add_trace(go.Scatter(x=buy['time'], y=buy['price'], mode='markers', name='BUY', marker=dict(color='lime', size=12, symbol='triangle-up')))
fig.add_trace(go.Scatter(x=sell['time'], y=sell['price'], mode='markers', name='SELL', marker=dict(color='red', size=12, symbol='triangle-down')))
fig.update_layout(template="plotly_dark", height=500, title="Live BTC/USDT Price & Signals")
st.plotly_chart(fig, use_container_width=True)

# PnL curve
st.line_chart(df.set_index('time')['pnl'], height=300, use_container_width=True)

# Recent trades table
st.subheader("Last 10 Signals")
recent = df.tail(10)[['time', 'price', 'signal']].copy()
recent['time'] = recent['time'].dt.strftime('%H:%M')
st.dataframe(recent, use_container_width=True)

st.success("Robot Status: ðŸŸ¢ LIVE â€¢ Running 24/7 â€¢ Next signal in 00:47")
